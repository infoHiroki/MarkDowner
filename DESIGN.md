# MarkDowner - マークダウンビューワー設計書

## 1. プロジェクト概要

### 1.1 目的
シンプルで高速なマークダウンビューワーをGo言語で実装する。KISS、DRY、YAGNI原則に従い、必要最小限の機能に絞る。

### 1.2 スコープ
- **含む**: マークダウンファイルの読み込みとHTML変換・表示
- **含まない**: 編集機能、ファイル保存、プラグイン機構

## 2. アーキテクチャ設計

### 2.1 全体構成
```
┌─────────────┐     ┌──────────────┐     ┌─────────────┐
│   Browser   │────▶│  Go Server   │────▶│  File I/O   │
│  (Client)   │◀────│   (API)      │◀────│             │
└─────────────┘     └──────────────┘     └─────────────┘
                           │
                           ▼
                    ┌──────────────┐
                    │   Markdown   │
                    │   Parser     │
                    └──────────────┘
```

### 2.2 コンポーネント
1. **Webサーバー**: 静的ファイルサーブとAPI提供
2. **マークダウンパーサー**: Markdown → HTML変換
3. **ファイルハンドラー**: ファイル読み込み処理
4. **フロントエンド**: シンプルなHTML/JS

## 3. 技術スタック

### 3.1 バックエンド
- **言語**: Go 1.21+
- **Webフレームワーク**: 標準ライブラリ (net/http)
- **マークダウンパーサー**: goldmark (高速・標準準拠)
- **テスト**: 標準のtestingパッケージ

### 3.2 フロントエンド
- **HTML5**: 最小限の構造
- **CSS**: インラインスタイル（外部ファイル不要）
- **JavaScript**: Vanilla JS（フレームワーク不使用）

## 4. API設計

### 4.1 エンドポイント
```
GET  /                  # メインページ
POST /api/render        # マークダウン変換API
GET  /api/file/{path}   # ファイル内容取得
```

### 4.2 API仕様

#### POST /api/render
リクエスト:
```json
{
  "markdown": "# Hello World\nThis is **bold** text."
}
```

レスポンス:
```json
{
  "html": "<h1>Hello World</h1>\n<p>This is <strong>bold</strong> text.</p>",
  "success": true
}
```

#### GET /api/file/{path}
レスポンス:
```json
{
  "content": "# File content...",
  "success": true
}
```

## 5. ディレクトリ構成

```
MarkDowner/
├── main.go              # エントリーポイント
├── go.mod              # Goモジュール定義
├── go.sum              # 依存関係ロック
├── internal/
│   ├── server/         # HTTPサーバー
│   │   └── server.go
│   ├── markdown/       # マークダウン処理
│   │   └── parser.go
│   └── handler/        # リクエストハンドラー
│       └── handler.go
├── web/                # 静的ファイル
│   └── index.html
├── cmd/                # CLIコマンド（将来拡張用）
└── test/               # テストファイル
    └── testdata/       # テスト用データ
```

## 6. 実装計画

### フェーズ1: 基本機能（MVP）
1. HTTPサーバー構築
2. マークダウンパーサー統合
3. 基本的なHTML UI
4. ファイル読み込み機能

### フェーズ2: 改善（必要に応じて）
1. エラーハンドリング強化
2. パフォーマンス最適化
3. セキュリティ強化

## 7. テスト戦略

### 7.1 ユニットテスト
- パーサー機能: 各種マークダウン記法の変換
- ハンドラー: HTTPリクエスト/レスポンス
- ファイルI/O: 読み込みエラー処理

### 7.2 統合テスト
- エンドツーエンドのファイル表示フロー
- APIレスポンスの検証

## 8. セキュリティ考慮事項
- XSS対策: HTMLサニタイズ
- パストラバーサル対策: ファイルパス検証
- CORS設定: 同一オリジンのみ許可

## 9. パフォーマンス目標
- 起動時間: < 100ms
- 1MBファイルの変換: < 50ms
- メモリ使用量: < 50MB

## 10. 制約事項
- 外部依存は最小限に
- 設定ファイル不要（ゼロコンフィグ）
- シングルバイナリで配布可能